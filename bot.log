---- ESTA ES LA PUTA VERSIÓN NUEVA DEL CÓDIGO: v_FINAL ----
2025-10-30 15:16:26 - bot_logger - INFO - Contrato de copywriter cargado correctamente desde '/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/copywriter_contract_hormozi.md'.
2025-10-30 15:16:26 - bot_logger - INFO - Pautas de revisión final cargadas desde '/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/config/final_review_guidelines.md'.
 * Serving Flask app 'bot'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://192.168.1.89:8080
Press CTRL+C to quit
2025-10-30 15:18:14 - bot_logger - INFO - Update recibido: {'update_id': 960471367, 'message': {'message_id': 3752, 'from': {'id': 1119810722, 'is_bot': False, 'first_name': 'Marco', 'last_name': 'Mei', 'username': 'marco_mei', 'language_code': 'en'}, 'chat': {'id': 1119810722, 'first_name': 'Marco', 'last_name': 'Mei', 'username': 'marco_mei', 'type': 'private'}, 'date': 1761833894, 'text': '/g', 'entities': [{'offset': 0, 'length': 2, 'type': 'bot_command'}]}}
2025-10-30 15:18:14 - bot_logger - INFO - [CHAT_ID: 1119810722] Comando '/g' recibido.
2025-10-30 15:18:14 - bot_logger - INFO - [CHAT_ID: 1119810722] Iniciando nuevo ciclo de generación.
127.0.0.1 - - [30/Oct/2025 15:18:14] "POST /webhook HTTP/1.1" 200 -
2025-10-30 15:18:14 - bot_logger - INFO - [CHAT_ID: 1119810722] Intento 1/5 de encontrar tema.
2025-10-30 15:18:14 - bot_logger - INFO - Buscando tema en 'topics_collection' (preferir menos similar a memoria)…
2025-10-30 15:18:14 - bot_logger - INFO - Inicializando cliente persistente local de ChromaDB (path='db')...
Exception in thread Thread-7 (do_the_work):
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1041, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 992, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/proposal_service.py", line 48, in do_the_work
    topic = find_relevant_topic()
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/core_generator.py", line 227, in find_relevant_topic
    topics_collection = get_topics_collection()
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/embeddings_manager.py", line 112, in get_topics_collection
    return client.get_or_create_collection(name="topics_collection", metadata={"hnsw:space": "cosine"})
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/api/client.py", line 237, in get_or_create_collection
    return self._server.get_or_create_collection(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        name=name,
        ^^^^^^^^^^
    ...<4 lines>...
        database=self.database,
        ^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/telemetry/opentelemetry/__init__.py", line 127, in wrapper
    return f(*args, **kwargs)
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/api/segment.py", line 217, in get_or_create_collection
    return self.create_collection(  # type: ignore
           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
        name=name,
        ^^^^^^^^^^
    ...<5 lines>...
        database=database,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/telemetry/opentelemetry/__init__.py", line 127, in wrapper
    return f(*args, **kwargs)
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/api/segment.py", line 167, in create_collection
    coll, created = self._sysdb.create_collection(
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        id=id,
        ^^^^^^
    ...<5 lines>...
        database=database,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/telemetry/opentelemetry/__init__.py", line 127, in wrapper
    return f(*args, **kwargs)
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/db/mixins/sysdb.py", line 209, in create_collection
    existing = self.get_collections(name=name, tenant=tenant, database=database)
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/telemetry/opentelemetry/__init__.py", line 127, in wrapper
    return f(*args, **kwargs)
  File "/Users/marcomeipersonal/Desktop/MMEI/Proyectos Personales/x_bot_mei/venv/lib/python3.13/site-packages/chromadb/db/mixins/sysdb.py", line 435, in get_collections
    rows = cur.execute(sql, params).fetchall()
           ~~~~~~~~~~~^^^^^^^^^^^^^
sqlite3.OperationalError: no such column: collections.topic
